<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ãƒãƒæŠœãå¤§ä¼šç®¡ç†</title>
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
<link rel="stylesheet" href="./style.css" />
<script src="./app.js"></script>
</head>
<body>

<pre id="view" style="white-space:pre-wrap;"></pre>

<div id="app">
  <div id="status" style="margin:8px 0;font-weight:bold;"></div>

<div id="sidebar">
  <h2>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
  <ul>
  <button onclick="navigate('scanSection')">ğŸ® ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†</button>
  <button onclick="navigate('rankingEntrySection')">ğŸ† é †ä½ç™»éŒ²</button>
  <button onclick="navigate('historySection')">ğŸ”” éŠ…é¸å±¥æ­´</button>
  <button onclick="window.open('https://example.com/rank', '_blank')">ğŸ“ˆ ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨</button>
  <button onclick="window.open('https://example.com/live', '_blank')">ğŸ“ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åº§å¸­</button>
  <button onclick="window.open('https://example.com/realtime-rank', '_blank')">ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
  </ul>
</div>

<main id="mainContent">
  <!-- æ‰‹å‹•ä¿å­˜ãƒœã‚¿ãƒ³ãƒ»CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ -->
  <section id="scanSection" class="section">
        <h2>QRã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³</h2>
        <div id="messageArea"></div>
        <div id="seatList"></div>
        <div id="readerContainer">
          <div id="reader"></div>
          <div id="overlayBox"></div>
        </div>
        <button id="exportPlayerBtn">ğŸ“ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼CSV</button>
        <button id="exportSeatBtn">ğŸª‘ åº§å¸­CSV</button>
        <button id="exportLeaveBtn">ğŸšª é›¢å¸­å±¥æ­´CSV</button>
        <button id="undoBtn">â†© Undo</button>
        <button id="redoBtn">â†ª Redo</button>
        <button onclick="saveToGAS()">â˜ ãƒ‡ãƒ¼ã‚¿ã‚’GASã«ä¿å­˜</button>
        <button onclick="loadFromGAS()">ğŸ”„ GASã‹ã‚‰èª­ã¿è¾¼ã¿</button>
        <pre id="output"></pre>
  </section>
        <!-- é †ä½ç™»éŒ²UI -->
  <section id="rankingEntrySection" class="section" style="display:none">
     <h2>é †ä½ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰</h2>
     <p>QRã‚³ãƒ¼ãƒ‰ã§åº§å¸­ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„ã€‚</p>
     <div id="rankingReader" style="width: 320px; height: 320px;"></div>
     <ul id="rankingList" class="draggable-list"></ul>
     <button id="confirmRankingBtn">âœ… é †ä½ã‚’æ±ºå®š</button>
  </section>

  <section id="historySection" class="section" style="display: none;">
  <h2>ğŸ”” éŠ…é¸å±¥æ­´</h2>
  <div id="historyList"></div>
  <button onclick="navigate('scanSection')">â¬… æˆ»ã‚‹</button>
</section>
</main>
 <script>
seatMap = {};

const PROXY_URL = "https://gas-proxy-jmxd.onrender.com";

// âœ… seatMapï¼ˆåº§å¸­ID â†’ ç”Ÿå¾’IDã®é…åˆ—ï¼‰ã‚’ä¿å­˜
async function saveToGAS() {
  try {
    const res = await fetch(`${PROXY_URL}/post`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ seatMap }), // â† seatMap ã ã‘é€ä¿¡
    });
    const result = await res.text();
    console.log("ä¿å­˜çµæœ:", result);
  } catch (err) {
    console.error("ä¿å­˜å¤±æ•—:", err);
  }
}

// âœ… seatMap ã‚’èª­ã¿è¾¼ã¿
async function loadFromGAS() {
  try {
    const res = await fetch(`${PROXY_URL}/get`);
    const data = await res.json();
    if (data.seatMap) {
      seatMap = data.seatMap; // â† èª­ã¿è¾¼ã‚“ã seatMapã‚’ä»£å…¥
      console.log("èª­ã¿è¾¼ã‚“ã  seatMap:", seatMap);
    } else {
      console.warn("seatMap ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");
    }
  } catch (err) {
    console.error("èª­ã¿è¾¼ã¿å¤±æ•—:", err);
  }
}

  </script>
</body>
</html>
