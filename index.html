<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ババ抜き大会管理</title>
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
<link rel="stylesheet" href="./style.css" />
<script type="module" src="./app.js"></script>
</head>
<body>

<pre id="view" style="white-space:pre-wrap;"></pre>

<div id="app">
  <div id="status" style="margin:8px 0;font-weight:bold;"></div>

<div id="sidebar">
  <h2>メニュー</h2>
  <ul>
  <button onclick="navigate('scanSection')">🎮 プレイヤー管理</button>
  <button onclick="navigate('rankingEntrySection')">🏆 順位登録</button>
  <button onclick="navigate('historySection')">🔔 銅鐸履歴</button>
  <button onclick="window.open('https://example.com/rank', '_blank')">📈 ランキング表</button>
  <button onclick="window.open('https://example.com/live', '_blank')">📍 リアルタイム座席</button>
  <button onclick="window.open('https://example.com/realtime-rank', '_blank')">📊 リアルタイムランキング</button>
  </ul>
</div>

<main id="mainContent">
  <!-- 手動保存ボタン・CSVエクスポートボタン -->
  <section id="scanSection" class="section">
        <h2>QRコードスキャン</h2>
        <div id="messageArea"></div>
        <div id="seatList"></div>
        <div id="readerContainer">
          <div id="reader"></div>
          <div id="overlayBox"></div>
        </div>
        <button id="exportPlayerBtn">🎓 プレイヤーCSV</button>
        <button id="exportSeatBtn">🪑 座席CSV</button>
        <button id="exportLeaveBtn">🚪 離席履歴CSV</button>
        <button id="undoBtn">↩ Undo</button>
        <button id="redoBtn">↪ Redo</button>
        <button onclick="saveToGAS()">☁ データをGASに保存</button>
        <button onclick="loadFromGAS()">🔄 GASから読み込み</button>
        <pre id="result"></pre>
  </section>
        <!-- 順位登録UI -->
  <section id="rankingEntrySection" class="section" style="display:none">
     <h2>順位登録モード</h2>
     <p>QRコードで座席を読み込んでください。</p>
     <div id="rankingReader" style="width: 320px; height: 320px;"></div>
     <ul id="rankingList" class="draggable-list"></ul>
     <button id="confirmRankingBtn">✅ 順位を決定</button>
  </section>

  <section id="historySection" class="section" style="display: none;">
  <h2>🔔 銅鐸履歴</h2>
  <div id="historyList"></div>
  <button onclick="navigate('scanSection')">⬅ 戻る</button>
</section>
</main>
 <script>
    const proxyBase = "http://localhost:3000"; // Node.jsサーバーURL

    const samplePayload = {
      seatMap: { table01: ["player01", "player02"] },
      playerData: { player01: { name: "田中", rate: 100 } },
      douTakuRecords: []
    };

    document.getElementById("saveToGAS").onclick = () => {
      fetch(proxyBase + "/save", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(samplePayload),
      })
      .then(res => res.text())
      .then(txt => {
        document.getElementById("result").textContent = "保存結果: " + txt;
      })
      .catch(err => {
        document.getElementById("result").textContent = "保存エラー: " + err;
      });
    };

    document.getElementById("loadFromGAS").onclick = () => {
      fetch(proxyBase + "/load")
      .then(res => res.json())
      .then(data => {
        document.getElementById("result").textContent = "読み込み結果:\n" + JSON.stringify(data, null, 2);
      })
      .catch(err => {
        document.getElementById("result").textContent = "読み込みエラー: " + err;
      });
    };
  </script>
</body>
</html>
