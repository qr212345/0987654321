<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <title>座席管理システム</title>
  </head>
  <body>
    <section id="welcomeScreen" class="full-screen section active">
      <div class="welcome-content">
        <h1>🎉 大会へようこそ 🎉</h1>
        <p>画面をタッチ／クリックして順位登録モードに進む</p>
      </div>
    </section>
    
    <button class="toggle-btn" onclick="toggleSidebar()">☰ メニュー</button>
    
    <div class="sidebars" id="sidebars">
      <h2>メニュー</h2>
      <button href="#">ホーム</button>
      <br><button onclick="navigate('scanSection')">💽QRスキャン</button>
      <br><button onclick="navigate('rankingSection')">💾 順位登録</button>
      <br><button onclick="navigate('historySection')">🔔 履歴</button>
      <br><button onclick="navigate('helpSection')">🔎 操作ヘルプ</button>
      <br><button onclick="openThemeBtn();">🎨テーマ編集</button>
      <br><button id="adminStatus" onclick="activateAdminMode();">🔑 管理者モード有効化[未有効]</button>
      <br><button onclick="window.open('https://qr212345.github.io/QW/')">📍 リアルタイム座席</button>
      <br><button onclick="window.open('https://qr212345.github.io/rankingusheet/')">📊 リアルタイムランキング</button>
      <br><button href="#">設定</button>
      <br><button href="#">ログアウト</button>
    </div>
    
    <main class="main" id="main">
      <header>
        <h1>座席管理システム</h1>
      </header>
      
      <!-- メッセージ表示 -->
      <div id="messageArea" class="message-area"></div>
      
      <!-- QRスキャンセクション -->
      <section id="scanSection" class="section" style="display:none;">
        <h2>QRコードスキャン</h2>
        <div id="reader" class="qr-reader"></div>
        <p id="result">読み取り結果がここに表示されます</p>
        <div id="seatList" class="seat-list"></div>
        <div class="controls">
          <button id="undoBtn">↩ Undo</button>
          <button id="redoBtn">↪ Redo</button>
          <button id="exportPlayerBtn">📄 プレイヤーCSV</button>
          <button id="exportSeatBtn">📜 座席CSV</button>
          <button id="saveToGASBtn">📥 GAS保存</button>
          <button id="loadFromGASBtn">📤 GAS読み込み</button>
        </div>
      </section>
    
      <!-- 順位登録セクション -->
      <section id="rankingSection" class="section" style="display:none;">
        <h2>順位登録モード</h2>
        <div id="rankingReader" class="qr-reader"></div>
        <div id="multiRankingArea" class="ranking-list"></div>
        <ul id="rankingList" class="ranking-list"></ul>
        <button id="confirmRankingBtn">🏆 順位確定</button>
        <button id="flushBtn">📨まとめて送信</button>
        <p>ドラッグで順位を入れ替えてください</p>
      </section>

      <!-- 履歴セクション -->
      <section id="historySection" class="section" style="display:none;">
        <h2>🎞️ 履歴</h2>
        <button id="exportHistoryBtn">📤 CSV出力</button>
        <div id="historyList" class="history-list"></div>
      </section>

      <!-- 操作ヘルプセクション -->
      <section id="helpSection" class="section" style="display:none;">
        <div class="help-container">
          <button id="closeHelpBtn" onclick="navigate('scanSection')">閉じる ✖</button>
          <h2>操作手順</h2>
          <ol>
            <li>QRコードをスキャンして座席とプレイヤーを登録</li>
            <li>Undo/Redoで操作を修正</li>
            <li>順位登録モードで座席QRをスキャンし、ドラッグで順位確定</li>
            <li>CSVエクスポートやGAS保存でデータ管理</li>
            <li>テーマパネルで座席・プレイヤーの色やフォントサイズを変更可能</li>
            <li>履歴セクションで登録・操作の記録を確認</li>
            <li>タイマーでイベント時間を管理</li>
          </ol>
        </div>
      </section>

      <section id="themeSection">
        <h3>
        テーマ編集
        <button id="closeThemeBtn" style="float:right;">×</button>
        </h3>

        <div class="theme-controls">
          <label>座席背景: <input type="color" id="seatBgColor" value="#f5f5f5"></label><br>
          <label>プレイヤー背景: <input type="color" id="playerBgColor" value="#d0f0c0"></label><br>
          <label>ボタン背景: <input type="color" id="buttonBgColor" value="#4CAF50"></label><br>
          <label>ボタン文字色: <input type="color" id="buttonColor" value="#ffffff"></label><br>
          <label>フォントサイズ: <input type="number" id="fontSizeInput" value="14" style="width:60px">px</label><br>
          <button id="applyThemeBtn">適用</button>
        </div>
      </section>
    </main>

    <!-- テーマパネル -->
    <div id="themePanel" style="display:none;"></div>

    <script src="app.js"></script>
    <script>
      function toggleSidebar() {
        const sidebars = document.getElementById("sidebars");
        const main = document.getElementById("main");
        sidebars.classList.toggle("open");
        main.classList.toggle("shifted");
      }
    </script>
  </body>
</html>
